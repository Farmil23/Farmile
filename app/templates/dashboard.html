{% extends "base.html" %}
{% block content %}
<div class="dashboard-layout">
  <!-- Mobile Menu Toggle -->
  <button class="mobile-menu-toggle" id="mobileMenuToggle">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </button>

  <!-- Sidebar Overlay (Mobile) -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <!-- Dashboard Sidebar -->
  <aside class="dashboard-sidebar" id="dashboardSidebar">

    <!-- User Profile Section -->
  <!-- 
    <div class="sidebar-profile">
      <div class="profile-avatar">
        <img src="{{ current_user.profile_pic }}" alt="Profile" class="sidebar-profile-pic">
        <div class="profile-status online"></div>
      </div>
      <div class="profile-info">
        <h3 class="profile-name" style="font-size: 1.2rem;">{{ current_user.name }}</h3>
        <p class="profile-role" style="font-size: 0.8rem;">{{ current_user.career_path|replace('-', ' ')|title if current_user.career_path else 'Explorer' }}</p>
        <div class="profile-level">
          <div class="level-progress">
            <div class="level-fill" style="width: {{ ((current_user.user_progress.count() / 50) * 100)|round|int }}%"></div>
          </div>
          <span class="level-text">Level {{ (current_user.user_progress.count() // 10) + 1 }}</span>
        </div>
      </div>
    </div>
  -->
    <!-- Navigation Menu -->
    <nav class="sidebar-nav">
      <div class="nav-section">
        <h4 class="nav-heading">Menu Utama</h4>
        <div class="nav-links">
          <a href="{{ url_for('routes.dashboard') }}" class="nav-link active">
            <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="7" height="7"></rect>
              <rect x="14" y="3" width="7" height="7"></rect>
              <rect x="14" y="14" width="7" height="7"></rect>
              <rect x="3" y="14" width="7" height="7"></rect>
            </svg>
            <span class="nav-text">Dashboard</span>
          </a>
          <a href="{{ url_for('routes.roadmap') }}" class="nav-link">
            <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 3v5h5"></path>
              <path d="M3 8.01V21"></path>
              <path d="M21 3v5h-5"></path>
              <path d="M16 8.01V21"></path>
              <path d="M12 3v5h-5"></path>
              <path d="M7 8.01V21"></path>
            </svg>
            <span class="nav-text">Roadmap</span>
          </a>
          <a href="{{ url_for('routes.chatbot') }}" class="nav-link">
            <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            <span class="nav-text">AI Mentor</span>
            <span class="nav-badge">24/7</span>
          </a>
          <a href="{{ url_for('routes.my_projects') }}" class="nav-link">
            <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
            </svg>
            <span class="nav-text">Proyek Saya</span>
          </a>
        </div>
      </div>

      <div class="nav-section">
        <h4 class="nav-heading">Akun</h4>
        <div class="nav-links">
          <a href="{{ url_for('routes.profile') }}" class="nav-link">
            <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <span class="nav-text">Profil</span>
          </a>
          <a href="{{ url_for('routes.edit_profile') }}" class="nav-link">
            <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
            <span class="nav-text">Edit Profil</span>
          </a>
          <a href="{{ url_for('routes.logout') }}" class="nav-link logout">
            <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
              <polyline points="16 17 21 12 16 7"></polyline>
              <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            <span class="nav-text">Logout</span>
          </a>
        </div>
      </div>
    </nav>

    <!-- Quick Stats -->
    <div class="sidebar-footer">
      <div class="quick-stats">
        <div class="quick-stat">
          <span class="stat-value">{{ current_user.user_progress.count() }}</span>
          <span class="stat-label">Materi</span>
        </div>
        <div class="quick-stat">
          <span class="stat-value">{{ current_user.submissions.count() }}</span>
          <span class="stat-label">Proyek</span>
        </div>
        <div class="quick-stat">
          <span class="stat-value">{{ ((current_user.user_progress.count() / 50) * 100)|round|int }}%</span>
          <span class="stat-label">Progress</span>
        </div>
      </div>
    </div>
  </aside>

  <main class="dashboard-content">
    <!-- Dashboard Header -->
    <div class="dashboard-header">
      <div class="welcome-section">
        <h1 class="dashboard-title">Selamat Datang Kembali!</h1>
        <p class="dashboard-subtitle">
          Mari lanjutkan perjalanan belajar Anda hari ini. 
          {% if current_user.career_path %}
            Jalur <strong>{{ current_user.career_path|replace('-', ' ')|title }}</strong> menanti Anda.
          {% else %}
            Mulai dengan memilih jalur karier Anda.
          {% endif %}
        </p>
      </div>
      <div class="dashboard-actions">
        <a href="{{ url_for('routes.chatbot') }}" class="quick-action-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
          </svg>
          <span>Chat AI</span>
        </a>
        <a href="{{ url_for('routes.profile') }}" class="quick-action-btn secondary">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          <span>Profil</span>
        </a>
      </div>
    </div>

    <!-- Stats Overview -->
    <div class="stats-overview">
      <div class="stat-card">
        <div class="stat-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ current_user.user_progress.count() }}</div>
          <div class="stat-label">Materi Diselesaikan</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
            <polyline points="2 17 12 22 22 17"></polyline>
            <polyline points="2 12 12 17 22 12"></polyline>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ current_user.submissions.count() }}</div>
          <div class="stat-label">Proyek Aktif</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ progress_percentage }}%</div>
          <div class="stat-label">Progress Keseluruhan</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ current_user.chat_sessions.count() }}</div>
          <div class="stat-label">Sesi Chat</div>
        </div>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="dashboard-grid">
      <!-- Learning Path Card -->
      <div class="dashboard-card main-card">
        <div class="card-header">
          <div class="card-title-section">
            <h3 class="card-title">Jalur Belajar Anda</h3>
            <div class="card-badge">
              {% if current_user.career_path %}
                {{ current_user.career_path|replace('-', ' ')|title }}
              {% else %}
                Belum Dipilih
              {% endif %}
            </div>
          </div>
          <div class="card-progress">

            <span class="progress-text">
              {% if current_user.modules.count() > 0 %}
                {% set total_lessons = current_user.modules.join(Lesson).count() %}
                {% if total_lessons > 0 %}
                  {% set progress_percentage = ((current_user.user_progress.count() / total_lessons) * 100)|round|int %}
                  {{ progress_percentage }}% Selesai
                {% else %}
                  0% Selesai
                {% endif %}
              {% else %}
                0% Selesai
              {% endif %}
            </span>
          </div>
        </div>
        <div class="card-content">
        {% if current_user.career_path %}
          <p class="card-description">
            Lanjutkan perjalanan belajar Anda di jalur <strong>{{ current_user.career_path|replace('-', ' ')|title }}</strong>. 
            {% if current_user.modules.count() > 0 %}
              {% set total_lessons = current_user.modules.join(Lesson).count() %}
              Anda telah menyelesaikan {{ current_user.user_progress.count() }} dari {{ total_lessons }} materi yang tersedia.
            {% else %}
              Mulai dengan membuat roadmap belajar Anda.
            {% endif %}
          </p>
          
          <div class="card-actions">
            <a href="{{ url_for('routes.roadmap') }}" class="button-primary">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
              </svg>
              Lihat Roadmap
            </a>
            <a href="#" class="button-secondary">Lanjutkan Belajar</a>
          </div>
        {% else %}
          <p class="card-description">
            Mulai perjalanan belajar Anda dengan memilih jalur karier yang sesuai dengan minat dan tujuan Anda.
          </p>
          <div class="card-actions">
            <a href="#" class="button-primary">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 5v14M5 12h14"></path>
              </svg>
              Pilih Jalur Karier
            </a>
          </div>
        {% endif %}
        </div>
      </div>

      <!-- AI Mentor Card -->
      <div class="dashboard-card">
        <div class="card-header">
          <div class="card-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
          </div>
          <h3 class="card-title">Mentor AI</h3>
        </div>
        <div class="card-content">
          <p class="card-description">
            Dapatkan bantuan instan dari AI mentor untuk pertanyaan teknis, review kode, atau saran karier.
          </p>
          <div class="card-actions">
            <a href="{{ url_for('routes.chatbot') }}" class="button-primary full-width">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
              </svg>
              Mulai Percakapan
            </a>
          </div>
        </div>
      </div>

      <!-- Active Projects Card -->
      <div class="dashboard-card">
        <div class="card-header">
          <div class="card-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
              <polyline points="2 17 12 22 22 17"></polyline>
              <polyline points="2 12 12 17 22 12"></polyline>
            </svg>
          </div>
          <h3 class="card-title">Proyek Aktif</h3>
        </div>
        <div class="card-content">
          {% if current_user.submissions.count() > 0 %}
            {% for submission in current_user.submissions.order_by(ProjectSubmission.id.desc()).limit(1) %}
            <div class="project-item">
              <div class="project-info">
                <h4 class="project-name">{{ submission.project.title }}</h4>
                <p class="project-status">
                  {% if submission.interview_score %}
                    Selesai (Skor: {{ submission.interview_score }})
                  {% else %}
                    Menunggu Wawancara
                  {% endif %}
                </p>
              </div>
              <div class="project-progress">
                <div class="progress-bar small">
                  {% if submission.interview_score %}
                    <div class="progress-fill" style="width: 100%"></div>
                  {% else %}
                    <div class="progress-fill" style="width: 50%"></div>
                  {% endif %}
                </div>
              </div>
            </div>
            {% endfor %}
          {% else %}
            <div class="project-item">
              <div class="project-info">
                <h4 class="project-name">Belum Ada Proyek</h4>
                <p class="project-status">Mulai proyek pertama Anda</p>
              </div>
            </div>
          {% endif %}
          <div class="card-actions">
            <a href="{{ url_for('routes.my_projects') }}" class="button-secondary full-width">
              {% if current_user.submissions.count() > 0 %}
                Lihat Semua Proyek
              {% else %}
                Pilih Proyek Pertama
              {% endif %}
            </a>
          </div>
        </div>
    </div>

      <!-- Daily Challenge Card -->
      <div class="dashboard-card">
        <div class="card-header">
          <div class="card-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
            </svg>
          </div>
          <h3 class="card-title">Tantangan Harian</h3>
        </div>
        <div class="card-content">
          <div class="challenge-item">
            <h4 class="challenge-name">Palindrome Checker</h4>
            <p class="challenge-difficulty">Level: Intermediate</p>
            <div class="challenge-reward">
              <span class="reward-icon">🏆</span>
              <span class="reward-text">+50 XP</span>
            </div>
          </div>
          <div class="card-actions">
            <a href="#" class="button-primary full-width">
              Mulai Tantangan
            </a>
          </div>
        </div>
      </div>

      <!-- Recent Activity Card -->
      <div class="dashboard-card full-width">
        <div class="card-header">
          <div class="card-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
              <path d="M3 3v5h5"></path>
            </svg>
          </div>
          <h3 class="card-title">Aktivitas Terbaru</h3>
        </div>
        <div class="card-content">
          <div class="activity-list">
            {% set has_activity = false %}
            
            <!-- Recent chat sessions -->
            {% if recent_sessions is defined and recent_sessions %}
              {% for session in recent_sessions[:1] %}
                {% set has_activity = true %}
                <div class="activity-item">
                  <div class="activity-icon chat">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                  </div>
                  <div class="activity-content">
                    <p class="activity-text">Chat dengan AI Mentor: "{{ session.title }}"</p>
                    <span class="activity-time">{{ session.timestamp.strftime('%d %b %Y') if session.timestamp else 'Baru saja' }}</span>
                  </div>
                </div>
              {% endfor %}
            {% endif %}
            
            <!-- Recent project submissions -->
            {% if recent_submissions is defined and recent_submissions %}
              {% for submission in recent_submissions[:1] %}
                {% set has_activity = true %}
                <div class="activity-item">
                  <div class="activity-icon project">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
                    </svg>
                  </div>
                  <div class="activity-content">
                    <p class="activity-text">Submit proyek: "{{ submission.project.title }}"</p>
                    <span class="activity-time">Baru saja</span>
                  </div>
                </div>
              {% endfor %}
            {% endif %}
            
            <!-- Recent progress -->
            {% if recent_progress is defined and recent_progress %}
              {% for progress in recent_progress[:1] %}
                {% set has_activity = true %}
                <div class="activity-item">
                  <div class="activity-icon completed">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                  </div>
                  <div class="activity-content">
                    <p class="activity-text">Menyelesaikan materi: "{{ progress.lesson.title if progress.lesson else 'Materi' }}"</p>
                    <span class="activity-time">{{ progress.completed_at.strftime('%d %b %Y') if progress.completed_at else 'Baru saja' }}</span>
                  </div>
                </div>
              {% endfor %}
            {% endif %}
            
            {% if not has_activity %}
              <div class="activity-item">
                <div class="activity-icon completed">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                  </svg>
                </div>
                <div class="activity-content">
                  <p class="activity-text">Selamat datang! Mulai perjalanan belajar Anda</p>
                  <span class="activity-time">Sekarang</span>
                </div>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const mobileMenuToggle = document.getElementById('mobileMenuToggle');
    const sidebar = document.getElementById('dashboardSidebar');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    const sidebarClose = document.getElementById('sidebarClose');

    // Toggle sidebar on mobile menu button click
    mobileMenuToggle.addEventListener('click', function() {
        sidebar.classList.add('active');
        sidebarOverlay.classList.add('active');
        document.body.style.overflow = 'hidden';
    });

    // Close sidebar on close button click
    sidebarClose.addEventListener('click', function() {
        closeSidebar();
    });

    // Close sidebar on overlay click
    sidebarOverlay.addEventListener('click', function() {
        closeSidebar();
    });

    // Close sidebar on escape key press
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && sidebar.classList.contains('active')) {
            closeSidebar();
        }
    });

    // Close sidebar function
    function closeSidebar() {
        sidebar.classList.remove('active');
        sidebarOverlay.classList.remove('active');
        document.body.style.overflow = '';
    }

    // Handle window resize
    window.addEventListener('resize', function() {
        if (window.innerWidth > 1024) {
            closeSidebar();
        }
    });

    // Add active class to current page nav link
    const currentPath = window.location.pathname;
    const navLinks = document.querySelectorAll('.nav-link');
    
    navLinks.forEach(link => {
        if (link.getAttribute('href') === currentPath) {
            link.classList.add('active');
        } else {
            link.classList.remove('active');
        }
    });
});
</script>

{% endblock %}
