{% extends "base.html" %}
{% block content %}
<div class="dashboard-layout">
    {% include 'dashboard_sidebar.html' %}
    <main class="dashboard-content">
        <div class="page-header">
            </div>
        <h4>Progres Keseluruhan: {{ progress }}%</h4>
        <div class="progress-bar">
            <div class="progress-bar-inner" style="width: {{ progress }}%;"></div>
        </div>
        <div class="module-accordion">
            {% for module in modules %}
            <details class="module-item card" open>
                <summary>
                    <div class="summary-title">
                        <span class="module-order">Bagian {{ module.order }}</span>
                        {{ module.title }}
                    </div>
                </summary>
                <ul class="lesson-list">
                    {% for lesson in module.lessons.order_by('order').all() %}
                    <li class="lesson-item">
                        <div class="lesson-main">
                            <input type="checkbox" id="lesson-{{ lesson.id }}" data-lesson-id="{{ lesson.id }}" 
                                   {% if lesson.id in completed_lesson_ids %}checked{% endif %}>
                            <label for="lesson-{{ lesson.id }}" class="lesson-label">
                                </label>
                        </div>
                        <div class="lesson-actions">
                            <form action="{{ url_for('routes.new_chat_for_lesson', lesson_id=lesson.id) }}" method="POST">
                                <button type="submit" class="button-secondary ask-ai-btn">Tanya AI</button>
                            </form>
                            <a href="{{ lesson.url or '#' }}" target="_blank" class="learn-link button-primary">Mulai Belajar</a>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            </details>
            {% endfor %}
        </div>
    </main>
</div>
{% endblock %}