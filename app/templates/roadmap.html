{% extends "dashboard_base.html" %}

{% block styles %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/roadmap.css') }}">
{% endblock %}

{% block dashboard_content %}
<div class="roadmap-container">
    
    <div class="roadmap-header">
        <p class="roadmap-supertitle">Roadmap Belajar</p>
        
        {# Logika pemetaan nama jalur karier #}
        {% set career_map = {
            'frontend': 'Frontend Developer',
            'backend': 'Backend Developer',
            'data-analyst': 'Data Analyst',
            'ai-ml-engineer': 'AI/ML Engineer',
            'devops-engineer': 'DevOps Engineer',
            'cyber-security': 'Cyber Security',
            'network-engineer': 'Network Engineer'
        } %}
        <h2>{{ career_map.get(current_user.career_path, current_user.career_path|replace('-', ' ')|title) }}</h2>
        
        <p class="subtitle">Ikuti alur belajar ini langkah demi langkah untuk menguasai skill yang dibutuhkan industri.</p>
        
        <div class="header-actions">
            <button id="open-change-path-modal" class="button-secondary">
                <i class="fas fa-exchange-alt"></i> Ganti Jalur Karier
            </button>
        </div>
    </div>
    <div class="card certificate-card">
        <h4>Sertifikat Kelulusan Roadmap</h4>
        {% if certificate %}
            <p>Selamat! Anda telah menyelesaikan semua materi dan proyek di roadmap ini.</p>
            <a href="{{ url_for('routes.view_credential', credential_id=certificate.credential_id) }}" class="button-primary" target="_blank">
                <i class="fas fa-certificate"></i> Lihat Sertifikat Anda
            </a>
        {% elif is_fully_completed %}
            <p>Luar biasa! Sertifikat Anda sedang dibuat. Silakan muat ulang halaman dalam beberapa saat.</p>
        {% else %}
            <p>Selesaikan semua materi dan proyek untuk membuka sertifikat kelulusan Anda.</p>
            <div class="button-disabled" title="Selesaikan semua progres untuk membuka">
                <i class="fas fa-lock"></i> Buka Sertifikat
            </div>
        {% endif %}
    </div>

    <div class="module-accordion">
        {% for module in modules %}
        <details class="module-item" {% if loop.first %}open{% endif %}>
            <summary class="module-summary">
                <div class="module-order">{{ module.order }}</div>
                <div class="module-title">{{ module.title }}</div>
            </summary>
            <div class="module-content">
                <ul class="lesson-list">
                    {% for lesson in module.lessons %}
                    <li class="lesson-item">
                        <div class="lesson-details">
                            <div class="lesson-status">
                                {% if lesson.id in completed_lesson_ids %}
                                    <svg class="icon-completed" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                                {% else %}
                                    <svg class="icon-pending" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle></svg>
                                {% endif %}
                            </div>
                            <div class="lesson-info">
                                <strong>{{ lesson.title }}</strong>
                                <span>Estimasi: {{ lesson.estimated_time or '30' }} menit</span>
                            </div>
                        </div>
                        <div class="lesson-actions">
                            <a href="{{ url_for('routes.lesson_detail', lesson_id=lesson.id) }}" class="button-primary">Mulai Belajar</a>
                        </div>
                    </li>
                    {% endfor %}
                
                    {% for project in module.projects %}
                    <li class="lesson-item project-item">
                        <div class="lesson-details">
                            <div class="lesson-status">
                                {% if project.id in submitted_project_ids %}
                                    <svg class="icon-completed" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                                {% else %}
                                    <svg class="icon-project" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>
                                {% endif %}
                            </div>
                            <div class="project-card-header">
                                <h4>{{ project.title }}</h4>
                                {% if project.difficulty %}
                                    <span class="difficulty-badge difficulty-{{ project.difficulty.lower() }}">{{ project.difficulty }}</span>
                                {% endif %}
                            </div>
                        </div>
                         <div class="lesson-actions">
                            <a href="{{ url_for('routes.project_detail', project_id=project.id) }}" class="button-primary">Lihat Proyek</a>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </details>
        {% endfor %}
    </div>
</div>

<div id="change-path-modal" class="modal-overlay">
    <div class="modal-box card change-path-modal">
        <div class="modal-header">
            <h3>Pilih Jalur Karier Baru</h3>
            <button class="modal-close-btn">&times;</button>
        </div>
        <form action="{{ url_for('routes.change_career_path') }}" method="POST">
            <div class="modal-body">
                <div class="career-path-grid">
                    </div>
                <div class="career-description-panel">
                    <h4 id="career-desc-title">Frontend Developer</h4>
                    <p id="career-desc-text">Membangun antarmuka pengguna yang visual, interaktif, dan responsif untuk aplikasi web. Fokus pada pengalaman pengguna (UX) dan desain (UI).</p>
                </div>
            </div>
            <div class="modal-footer">
                <input type="hidden" name="new_path" id="selected-career-path" value="frontend">
                <button type="submit" class="button-primary">Ganti & Mulai Belajar</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}

{% block page_scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- Logika untuk Modal Ganti Jalur Karier ---
    const modal = document.getElementById('change-path-modal');
    const openBtn = document.getElementById('open-change-path-modal');
    const closeBtn = modal.querySelector('.modal-close-btn');

    const careerData = {
        'frontend': { title: 'Frontend Developer', icon: '💻', desc: 'Membangun antarmuka pengguna yang visual, interaktif, dan responsif untuk aplikasi web. Fokus pada pengalaman pengguna (UX) dan desain (UI).' },
        'backend': { title: 'Backend Developer', icon: '⚙️', desc: 'Merancang logika, database, dan API yang menjadi otak di balik aplikasi. Fokus pada performa, keamanan, dan skalabilitas.' },
        'data-analyst': { title: 'Data Analyst', icon: '📊', desc: 'Menganalisis data untuk menemukan wawasan bisnis, membuat visualisasi, dan membantu pengambilan keputusan berbasis data.' },
        'ai-ml-engineer': { title: 'AI/ML Engineer', icon: '🤖', desc: 'Membangun dan mendeploy model machine learning untuk membuat aplikasi cerdas, mulai dari prediksi hingga pengenalan gambar.' },
        'devops-engineer': { title: 'DevOps Engineer', icon: '🚀', desc: 'Mengotomatiskan dan mengoptimalkan proses pengembangan dan deployment software, dari kode hingga ke pengguna.' },
        'cyber-security': { title: 'Cyber Security', icon: '🛡️', desc: 'Melindungi sistem, jaringan, dan data dari ancaman digital. Fokus pada pertahanan, deteksi, dan respons insiden.' },
        'network-engineer': { title: 'Network Engineer', icon: '🌐', desc: 'Merancang, membangun, dan mengelola jaringan komputer yang menjadi tulang punggung komunikasi digital.' }
    };

    const grid = modal.querySelector('.career-path-grid');
    const descTitle = modal.querySelector('#career-desc-title');
    const descText = modal.querySelector('#career-desc-text');
    const hiddenInput = modal.querySelector('#selected-career-path');
    
    grid.innerHTML = ''; 

    // Buat kartu untuk setiap jalur karier
    Object.keys(careerData).forEach(key => {
        const data = careerData[key];
        const card = document.createElement('div');
        card.className = 'career-card-option';
        card.dataset.path = key;
        card.innerHTML = `<span class="icon">${data.icon}</span><span class="title">${data.title}</span>`;
        if (key === '{{ current_user.career_path }}') {
            card.classList.add('selected');
            hiddenInput.value = key;
            descTitle.textContent = data.title;
            descText.textContent = data.desc;
        }
        grid.appendChild(card);
    });

    const careerCards = grid.querySelectorAll('.career-card-option');

    // Tambahkan event listener untuk setiap kartu
    careerCards.forEach(card => {
        card.addEventListener('mouseover', () => {
            const path = card.dataset.path;
            descTitle.textContent = careerData[path].title;
            descText.textContent = careerData[path].desc;
        });
        card.addEventListener('click', () => {
            careerCards.forEach(c => c.classList.remove('selected'));
            card.classList.add('selected');
            hiddenInput.value = card.dataset.path;
        });
    });

    openBtn.addEventListener('click', () => modal.classList.add('visible'));
    closeBtn.addEventListener('click', () => modal.classList.remove('visible'));
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.classList.remove('visible');
        }
    });
});
</script>
{% endblock %}