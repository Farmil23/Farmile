{% extends "base.html" %}

{% block styles %}
{{ super() }}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<link rel="stylesheet" href="https://npmcdn.com/flatpickr/dist/themes/dark.css">
<link rel="stylesheet" href="{{ url_for('static', filename='css/personal_hub.css') }}">
{% endblock %}

{% block content %}
<div class="page-container" style="padding: 0;">
    <div class="hub-container">
        
        <aside class="hub-sidebar">
            <div class="sidebar-header">
                <h2 id="sidebar-date-today">Memuat...</h2>
                <p>Agenda Hari Ini</p>
                
            </div>
            
            <div class="ai-organizer-box">
                <p>Minta Farmile untuk menyusun prioritas berdasarkan agendamu hari ini.</p>
                <button id="ai-organizer-btn" class="button-primary" >Minta Saran AI</button>
                <a href="{{ url_for('routes.dashboard') }}" class="button-primary" style=' background-color: white'>Kembali ke Dasbor</a>
            </div>

            <div id="sidebar-events" class="sidebar-section">
                <h3>ACARA</h3>
                <ul class="item-list">
                    <li class="empty-item">Memuat...</li>
                </ul>
            </div>
            
            <div id="sidebar-tasks" class="sidebar-section">
                <h3>DAFTAR TUGAS</h3>
                <div id="task-categories-container">
                    <p class="empty-item">Memuat...</p>
                    
                </div>
                <button id="add-task-btn" class="button-secondary" style="width: 100%; margin-top: 16px;">+ Tambah Tugas</button>
            </div>
        </aside>

        <main class="hub-main-content">
            <div id="calendar"></div>
        </main>
    </div>
</div>

<div id="dailyAgendaModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="dailyAgendaTitle">Agenda Harian</h3>
            <button class="modal-close-btn">&times;</button>
        </div>
        <div id="dailyAgendaContent" style="max-height: 60vh; overflow-y: auto;"></div>
        <div class="modal-footer">
             <button id="addNewTaskFromDailyBtn" class="button-primary">+ Tambah Tugas</button>
             <button id="addNewEventFromDailyBtn" class="button-primary">+ Tambah Acara</button>
        </div>
    </div>
</div>

<div id="eventModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="eventModalTitle">Acara Baru</h3>
            <button class="modal-close-btn">&times;</button>
        </div>
        <form id="eventForm">
            <input type="hidden" id="eventId">
            <input type="hidden" id="eventColor" value="#3B82F6">
            <div class="form-group">
                <label for="eventTitle">Judul Acara</label>
                <input type="text" id="eventTitle" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="eventDescription">Deskripsi</label>
                <textarea id="eventDescription" class="form-control" rows="3"></textarea>
            </div>
            <div style="display: flex; gap: 1rem;">
                <div class="form-group" style="flex: 1;">
                    <label>Tanggal Mulai</label>
                    <input type="text" id="eventStartDate" class="form-control">
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>Waktu Mulai</label>
                    <input type="text" id="eventStartTime" class="form-control">
                </div>
            </div>
            <div style="display: flex; gap: 1rem;">
                <div class="form-group" style="flex: 1;">
                    <label>Tanggal Selesai</label>
                    <input type="text" id="eventEndDate" class="form-control">
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>Waktu Selesai</label>
                    <input type="text" id="eventEndTime" class="form-control">
                </div>
            </div>
            <div class="form-group">
                <label for="eventLink">Link (opsional)</label>
                <input type="url" id="eventLink" class="form-control">
            </div>
            <div class="form-group">
                <label for="eventReminder">Ingatkan saya</label>
                <select id="eventReminder" name="reminder_minutes" class="form-control">
                    <option value="5">5 menit sebelumnya</option>
                    <option value="10" selected>10 menit sebelumnya</option>
                    <option value="30">30 menit sebelumnya</option>
                    <option value="60">1 jam sebelumnya</option>
                    <option value="-1">Jangan ingatkan</option>
                </select>
            </div>
            <div class="form-group">
                <label>Warna</label>
                <div class="color-options">
                    <div class="color-option selected" data-color="#3B82F6" style="background-color: #3B82F6;"></div>
                    <div class="color-option" data-color="#10B981" style="background-color: #10B981;"></div>
                    <div class="color-option" data-color="#F59E0B" style="background-color: #F59E0B;"></div>
                    <div class="color-option" data-color="#EF4444" style="background-color: #EF4444;"></div>
                    <div class="color-option" data-color="#8B5CF6" style="background-color: #8B5CF6;"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" id="eventDeleteBtn" class="button-danger" style="margin-right: auto;">Hapus</button>
                <button type="submit" class="button-primary">Simpan</button>
            </div>
        </form>
    </div>
</div>

<div id="taskModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="taskModalTitle">Tugas Baru</h3>
            <button class="modal-close-btn">&times;</button>
        </div>
        <form id="taskForm">
            <input type="hidden" id="taskId">
            <div class="form-group">
                <label for="taskTitle">Judul Tugas</label>
                <input type="text" id="taskTitle" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="taskDescription">Deskripsi</label>
                <textarea id="taskDescription" class="form-control" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label for="taskDueDate">Batas Waktu</label>
                <input type="text" id="taskDueDate" class="form-control">
            </div>
            <div class="form-group">
                <label for="taskPriority">Prioritas</label>
                <select id="taskPriority" class="form-control">
                    <option value="low">Santai</option>
                    <option value="medium" selected>Biasa</option>
                    <option value="high">Penting</option>
                    <option value="urgent">Mendesak</option>
                </select>
            </div>
            
            <!-- SKS Estimator Fields -->
            <div style="border: 1px dashed #2DD4BF; padding: 10px; border-radius: 8px; margin-bottom: 1rem; background-color: rgba(45, 212, 191, 0.05);">
                <label style="color: #2DD4BF; font-weight: bold; display: block; margin-bottom: 0.5rem;" title="Sistem Kebut Semalam Estimator">‚è≥ SKS Estimator (AI Predict)</label>
                <div style="display: flex; gap: 1rem;">
                    <div class="form-group" style="flex: 1; margin-bottom: 0;">
                        <label for="taskPages" style="font-size: 0.85rem;">Jml. Halaman/Slide</label>
                        <input type="number" id="taskPages" class="form-control" placeholder="0" min="0">
                    </div>
                    <div class="form-group" style="flex: 1; margin-bottom: 0;">
                        <label for="taskIsCoding" style="font-size: 0.85rem;">Ada Coding?</label>
                        <select id="taskIsCoding" class="form-control">
                            <option value="false">Tidak</option>
                            <option value="true">Ya</option>
                        </select>
                    </div>
                </div>
                <div id="aiEstimationResult" style="margin-top: 8px; font-size: 0.9rem; color: #2DD4BF; min-height: 20px;"></div>
            </div>
            <!-- End SKS Fields -->

            <div class="form-group">
                <label for="taskReminder">Ingatkan saya</label>
                <select id="taskReminder" name="reminder_minutes" class="form-control">
                    <option value="15">15 menit sebelumnya</option>
                    <option value="30" selected>30 menit sebelumnya</option>
                    <option value="60">1 jam sebelumnya</option>
                    <option value="1440">1 hari sebelumnya</option>
                    <option value="-1">Jangan ingatkan</option>
                </select>
            </div>
            <div class="modal-footer">
                <button type="button" id="taskDeleteBtn" class="button-danger" style="margin-right: auto;">Hapus</button>
                <button type="submit" class="button-primary">Simpan</button>
            </div>
        </form>
    </div>
</div>

<div id="confirmDeleteModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 400px;">
        <div class="modal-header">
            <h3 id="confirmTitle">Konfirmasi Hapus</h3>
            <button class="modal-close-btn">&times;</button>
        </div>
        <p id="confirmMessage">Apakah Anda yakin ingin menghapus item ini?</p>
        <div class="modal-footer">
            <button id="cancelDeleteBtn" class="button-secondary">Batal</button>
            <button id="confirmDeleteBtn" class="button-danger">Ya, Hapus</button>
        </div>
    </div>
</div>
{% endblock %}


{% block scripts %}
{{ super() }}
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://npmcdn.com/flatpickr/dist/l10n/id.js"></script>
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>
<script>
    // Menyimpan konfigurasi URL ke objek global agar bisa diakses oleh file .js
    window.APP_CONFIG = {
        api: {
            events: "{{ url_for('routes.get_events') }}",
            tasks: "{{ url_for('routes.get_tasks') }}"
        },
        routes: {
            ask_ai: "{{ url_for('routes.ask_ai_from_hub') }}"
        }
    };
</script>
<script src="{{ url_for('static', filename='js/personal_hub.js') }}"></script>
{% endblock %}