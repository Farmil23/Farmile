{% extends "dashboard_base.html" %}

{% block styles %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/lesson_detail.css') }}">
{% endblock %}

{% block dashboard_content %}
<div class="content-layout">
    <div class="page-header">
        <div>
            <a href="{{ url_for('routes.roadmap') }}" class="back-link button-secondary">‹ Kembali ke Roadmap</a>
            <h1>{{ lesson.title }}</h1>
            <p class="subtitle">Modul: {{ lesson.module.title }}</p>
        </div>
    </div>

    <div class="card lesson-content">
        <h3>Tentang Materi Ini</h3>
        <p>{{ lesson.description or 'Deskripsi belum tersedia.' }}</p>
    
        <!-- KONTEN INTI DARI AI DITAMPILKAN DI SINI -->
        <div class="core-content">
            {% if lesson.content %}
                {{ lesson.content | safe }}
            {% else %}
                <h3>Materi Inti</h3>
                <p>Konten untuk materi ini akan segera tersedia.</p>
            {% endif %}
        </div>

        {% if lesson.video_url %}
        <h3>Video Pembelajaran</h3>
        <div class="video-container">
            <iframe width="560" height="315" src="{{ lesson.video_url.replace('watch?v=', 'embed/') }}"
                    title="YouTube video player"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen>
            </iframe>
        </div>
        {% endif %}

        {% if lesson.url %}
        <h3>Wawasan Tambahan</h3>
        <p>Untuk pemahaman lebih dalam, kunjungi artikel berikut:</p>
        <a href="{{ lesson.url }}" target="_blank" rel="noopener noreferrer" class="button-secondary">Baca Artikel Eksternal ↗</a>
        {% endif %}
    </div>

    <div class="lesson-actions">
        {% if is_completed %}
            <form action="{{ url_for('routes.uncomplete_lesson', lesson_id=lesson.id) }}" method="POST">
                <input type="hidden" name="source" value="detail">
                <button type="submit" class="button-secondary">Batal Tandai Selesai</button>
            </form>
        {% else %}

            <form action="{{ url_for('routes.new_chat_for_lesson', lesson_id=lesson.id) }}" method="POST" style= " margin-right: 1rem;">
                <button type="submit" class="button-secondary ask-ai-btn">Tanya AI</button>
            </form>

            <form action="{{ url_for('routes.complete_lesson', lesson_id=lesson.id) }}" method="POST">
                <input type="hidden" name="source" value="detail">
                <button type="submit" class="button-primary">Tandai Sudah Selesai ✔</button>
            </form>

            
        {% endif %}
    </div>
</div>
{% endblock %}
